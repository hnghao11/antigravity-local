"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const types_1 = require("../../common/commands/types");
const instance_1 = require("../../common/configuration/instance");
const commands_1 = require("../../common/constants/commands");
const views_1 = require("../../common/constants/views");
const issueTreeProvider_1 = require("../../common/views/issueTreeProvider");
const treeNode_1 = require("../../common/views/treeNode");
const messages_1 = require("../constants/messages");
const ossIssueCommandHelper_1 = require("./ossIssueCommandHelper");
class OssIssueTreeProvider extends issueTreeProvider_1.ProductIssueTreeProvider {
    constructor(logger, viewManagerService, contextService, ossService, configuration, languages, folderConfigs) {
        super(logger, contextService, ossService, configuration, languages, folderConfigs);
        this.logger = logger;
        this.viewManagerService = viewManagerService;
        this.contextService = contextService;
        this.ossService = ossService;
        this.configuration = configuration;
        this.languages = languages;
        this.folderConfigs = folderConfigs;
        this.onDidChangeTreeData = this.viewManagerService.refreshOssViewEmitter.event;
        this.getRunTestMessage = () => messages_1.messages.treeView.runTest;
        this.getIssueTitle = (issue) => `${issue.additionalData.packageName}@${issue.additionalData.version} - ${issue.title}`;
        this.getIssueRange = () => undefined;
    }
    getRootChildren() {
        var _a;
        if (!((_a = instance_1.configuration.getFeaturesConfiguration()) === null || _a === void 0 ? void 0 : _a.ossEnabled)) {
            return [
                new treeNode_1.TreeNode({
                    text: views_1.SNYK_ANALYSIS_STATUS.OSS_DISABLED,
                }),
            ];
        }
        return super.getRootChildren();
    }
    shouldShowTree() {
        return this.contextService.shouldShowOssAnalysis;
    }
    getIssueDescriptionText(dir, issueCount) {
        return `${dir} - ${issueCount} ${issueCount === 1 ? 'vulnerability' : 'vulnerabilities'}`;
    }
    filterIssues(issues) {
        return issues.filter((issue, index, self) => {
            return index === self.findIndex(t => t.id === issue.id);
        });
    }
    getOpenIssueCommand(issue, folderPath, _filePath, filteredIssues) {
        return {
            command: commands_1.SNYK_OPEN_ISSUE_COMMAND,
            title: '',
            arguments: [
                {
                    issueType: types_1.OpenCommandIssueType.OssVulnerability,
                    issue: (0, ossIssueCommandHelper_1.getOssIssueCommandArg)(issue, folderPath, filteredIssues),
                },
            ],
        };
    }
}
exports.default = OssIssueTreeProvider;
//# sourceMappingURL=ossVulnerabilityTreeProvider.js.map